<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentinel Tactical</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid #00ff88;
            margin-bottom: 20px;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            padding: 5px 15px;
            background: rgba(0, 255, 136, 0.2);
            border-radius: 20px;
            font-size: 14px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Assets Section */
        .assets-section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #00ff88;
        }

        .asset-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .asset-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .asset-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .asset-card.strong {
            border-color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
        }

        .asset-card.moderate {
            border-color: #ffcc00;
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.3);
        }

        .asset-card.weak {
            border-color: #ff4444;
            box-shadow: 0 0 15px rgba(255, 68, 68, 0.3);
        }

        .asset-info h3 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .asset-price {
            font-size: 14px;
            color: #aaa;
        }

        .badge {
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge.strong {
            background: #00ff88;
            color: #000;
        }

        .badge.moderate {
            background: #ffcc00;
            color: #000;
        }

        .badge.weak {
            background: #ff4444;
            color: #fff;
        }

        /* Buttons */
        .btn-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .btn {
            padding: 18px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            color: #000;
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.6);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: #fff;
            box-shadow: 0 5px 20px rgba(255, 68, 68, 0.4);
            display: none;
        }

        .btn-success {
            background: linear-gradient(135deg, #00ff88 0%, #00aa55 100%);
            color: #fff;
            display: none;
        }

        .btn-loss {
            background: linear-gradient(135deg, #ff4444 0%, #aa0000 100%);
            color: #fff;
            display: none;
        }

        /* Alert Overlay */
        .alert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: flash 0.5s infinite;
        }

        @keyframes flash {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 1; }
        }

        .alert-content {
            text-align: center;
            padding: 40px;
        }

        .alert-title {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
        }

        .alert-asset {
            font-size: 36px;
            margin-bottom: 30px;
        }

        .alert-direction {
            font-size: 64px;
            font-weight: bold;
            text-shadow: 0 0 30px rgba(255, 255, 255, 1);
        }

        /* Analysis Section */
        .analysis-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
        }

        .analysis-title {
            color: #00ff88;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .signal-card {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .signal-asset {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .signal-direction {
            font-size: 32px;
            color: #00ff88;
            font-weight: bold;
        }

        .signal-expiration {
            color: #aaa;
            margin-top: 10px;
        }

        /* History Section */
        .history-section {
            margin-top: 20px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .history-win {
            border-left: 4px solid #00ff88;
        }

        .history-loss {
            border-left: 4px solid #ff4444;
        }

        .history-info {
            flex: 1;
        }

        .history-result {
            font-weight: bold;
            font-size: 18px;
        }

        .result-win { color: #00ff88; }
        .result-loss { color: #ff4444; }

        /* Timer */
        .timer {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
            color: #00ff88;
            display: none;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 20px;
            color: #00ff88;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 255, 136, 0.3);
            border-top-color: #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Result Buttons */
        .result-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            display: none;
        }

        .result-buttons .btn {
            flex: 1;
        }

        /* Add Asset Input */
        .add-asset-section {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .add-asset-input {
            flex: 1;
            padding: 12px;
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        .add-asset-input::placeholder {
            color: #888;
        }

        .btn-add {
            padding: 12px 20px;
            background: #00ff88;
            color: #000;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">üéØ SENTINEL TACTICAL</div>
            <div class="status">
                <span class="status-dot"></span>
                <span id="connectionStatus">Online</span>
            </div>
        </div>

        <!-- Add Asset -->
        <div class="add-asset-section">
            <input type="text" class="add-asset-input" id="newAsset" placeholder="Adicionar par (ex: USD/JPY)">
            <button class="btn-add" onclick="addAsset()">+</button>
        </div>

        <!-- Assets List -->
        <div class="assets-section">
            <h2 class="section-title">üìä ATIVOS MONITORADOS</h2>
            <div class="asset-list" id="assetList">
                <!-- Assets will be loaded here -->
            </div>
        </div>

        <!-- Analysis Section -->
        <div class="analysis-section" id="analysisSection">
            <h3 class="analysis-title">üö® SINAL DETECTADO</h3>
            <div id="signalContent"></div>
        </div>

        <!-- Timer -->
        <div class="timer" id="timer">05:00</div>

        <!-- Main Buttons -->
        <div class="btn-section">
            <button class="btn btn-primary" id="startBtn" onclick="startSession()">
                üöÄ INICIAR SESS√ÉO
            </button>
            <button class="btn btn-danger" id="enteredBtn" onclick="tradeEntered()">
                ‚úÖ ENTREI!
            </button>
        </div>

        <!-- Result Buttons -->
        <div class="result-buttons" id="resultButtons">
            <button class="btn btn-success" onclick="recordResult('WIN')">
                üèÜ WIN
            </button>
            <button class="btn btn-loss" onclick="recordResult('LOSS')">
                ‚ùå LOSS
            </button>
        </div>

        <!-- History -->
        <div class="history-section">
            <h2 class="section-title">üìà HIST√ìRICO</h2>
            <div id="historyList">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Carregando...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Overlay -->
    <div class="alert-overlay" id="alertOverlay">
        <div class="alert-content">
            <div class="alert-title">üö® OPORTUNIDADE!</div>
            <div class="alert-asset" id="alertAsset">EUR/USD</div>
            <div class="alert-direction" id="alertDirection">COMPRA AGORA!</div>
        </div>
    </div>

    <script>
        // Config
        const API_URL = 'https://sentinel-backend-1-4xzq.onrender.com';
        let assets = ['EUR/USD', 'GBP/USD', 'BTC/USDT'];
        let sessionActive = false;
        let currentSignal = null;
        let tradeInProgress = false;
        let timerInterval = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadAssets();
            loadHistory();
            setInterval(updateAssets, 5000); // Update every 5 seconds
        });

        // Load Assets
        async function loadAssets() {
            const list = document.getElementById('assetList');
            list.innerHTML = '';
            
            for (const asset of assets) {
                const card = document.createElement('div');
                card.className = 'asset-card';
                card.id = asset-${asset.replace('/', '-')};
                card.innerHTML = `
                    <div class="asset-info">
                        <h3>${asset}</h3>
                        <div class="asset-price" id="price-${asset.replace('/', '-')}">Carregando...</div>
                    </div>
                    <div class="badge weak" id="badge-${asset.replace('/', '-')}">ANALISANDO</div>
                `;
                card.onclick = () => analyzeAsset(asset);
                list.appendChild(card);
            }
            
            updateAssets();
        }

        // Add Asset
        function addAsset() {
            const input = document.getElementById('newAsset');
            const asset = input.value.trim().toUpperCase();
            
            if (asset && !assets.includes(asset)) {
                assets.push(asset);
                input.value = '';
                loadAssets();
            }
        }

        // Update Assets Data
        async function updateAssets() {
            for (const asset of assets) {
                try {
                    const response = await fetch(${API_URL}/analyze/${encodeURIComponent(asset)});
                    const data = await response.json();
                    
                    updateAssetCard(asset, data);
                } catch (error) {
                    console.error(Erro ao atualizar ${asset}:, error);
                }
            }
        }

        // Update Asset Card
        function updateAssetCard(asset, data) {
            const safeId = asset.replace('/', '-');
            const card = document.getElementById(asset-${safeId});
            const badge = document.getElementById(badge-${safeId});
            const price = document.getElementById(price-${safeId});
            
            if (!card || !badge) return;
            
            // Update price
            if (data.price) {
                price.textContent = R$ ${data.price.toFixed(2)};
            }
            
            // Update badge
            card.classList.remove('strong', 'moderate', 'weak');
            badge.classList.remove('strong', 'moderate', 'weak');
            
            if (data.tier === 'FORTE') {
                card.classList.add('strong');
                badge.classList.add('strong');
                badge.textContent = 'üü¢ FORTE';
            } else if (data.tier === 'MODERADO') {
                card.classList.add('moderate');
                badge.classList.add('moderate');
                badge.textContent = 'üü° MODERADO';
            } else {
                card.classList.add('weak');
                badge.classList.add('weak');
                badge.textContent = 'üî¥ FRACO';
            }
            
            // Check for strong signal during active session
            if (sessionActive && data.tier === 'FORTE' && data.signal && !tradeInProgress) {
                showAlert(asset, data.signal.direction);
            }
        }

        // Analyze Specific Asset
        async function analyzeAsset(asset) {
            try {
                const response = await fetch(${API_URL}/analyze/${encodeURIComponent(asset)});
                const data = await response.json();
                
                const section = document.getElementById('analysisSection');
                const content = document.getElementById('signalContent');
                
                section.style.display = 'block';
                
                if (data.signal) {
                    content.innerHTML = `
                        <div class="signal-card">
                            <div class="signal-asset">${asset}</div>
                            <div class="signal-direction">${data.signal.direction === 'CALL' ? 'üìà COMPRA' : 'üìâ VENDA'}</div>
                            <div class="signal-expiration">‚è±Ô∏è Expira√ß√£o: ${data.signal.expiration} minutos</div>
                            <div style="margin-top: 10px; color: #aaa;">
                                Pre√ßo: ${data.signal.entry.toFixed(4)}<br>
                                RSI: ${data.indicators?.rsi || 'N/A'}
                            </div>
                        </div>
                    `;
                    
                    currentSignal = { asset, ...data.signal };
                } else {
                    content.innerHTML = `
                        <div class="signal-card" style="border-color: #ff4444;">
                            <div class="signal-asset">${asset}</div>
                            <div style="color: #ff4444;">Sem sinal no momento</div>
                            <div style="margin-top: 10px; color: #aaa;">
                                For√ßa: ${data.tier}<br>
                                Aguarde oportunidade FORTE üü¢
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Erro na an√°lise:', error);
            }
        }

        // Start Session
        function startSession() {
            sessionActive = true;
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('enteredBtn').style.display = 'block';
            
            // Play sound
            playSound('start');
            
            alert('üöÄ Sess√£o iniciada! Monitorando ativos...');
        }

        // Show Alert
        function showAlert(asset, direction) {
            tradeInProgress = true;
            currentSignal = { asset, direction };
            
            const overlay = document.getElementById('alertOverlay');
            const alertAsset = document.getElementById('alertAsset');
            const alertDirection = document.getElementById('alertDirection');
            
            alertAsset.textContent = asset;
            alertDirection.textContent = direction === 'CALL' ? 'COMPRA AGORA! üìà' : 'VENDA AGORA! üìâ';
            
            overlay.style.display = 'flex';
            
            // Play alert sound
            playSound('alert');
            
            // Vibrate
            if (navigator.vibrate) {
                navigator.vibrate([500, 200, 500, 200, 500]);
            }
            
            // Auto hide after 10 seconds
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 10000);
        }

        // Trade Entered
        function tradeEntered() {
            tradeInProgress = true;
            document.getElementById('enteredBtn').style.display = 'none';
            document.getElementById('resultButtons').style.display = 'flex';
            document.getElementById('timer').style.display = 'block';
            
            // Start 5 minute timer
            let seconds = 300; // 5 minutes
            const timerEl = document.getElementById('timer');
            
            timerInterval = setInterval(() => {
                seconds--;
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                timerEl.textContent = ${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')};
                
                if (seconds <= 0) {
                    clearInterval(timerInterval);
                    timerEl.textContent = '00:00';
                    playSound('finish');
                }
            }, 1000);
            
            playSound('enter');
        }

        // Record Result
        async function recordResult(result) {
            clearInterval(timerInterval);
            
            const trade = {
                asset: currentSignal?.asset || 'Unknown',
                direction: currentSignal?.direction || 'Unknown',
                result: result,
                timestamp: new Date().toISOString()
            };
            
            // Save to localStorage (in real app, send to backend)
            let history = JSON.parse(localStorage.getItem('tradeHistory') || '[]');
            history.unshift(trade);
            localStorage.setItem('tradeHistory', JSON.stringify(history));
            
            // Reset UI
            document.getElementById('resultButtons').style.display = 'none';
            document.getElementById('timer').style.display = 'none';
            document.getElementById('startBtn').style.display = 'block';
            
            tradeInProgress = false;
            currentSignal = null;
            
            // Play sound
            playSound(result === 'WIN' ? 'win' : 'loss');
            
            // Refresh history
            loadHistory();
            
            alert(${result === 'WIN' ? 'üèÜ WIN!' : '‚ùå LOSS'} registrado!);
        }

        // Load History
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('tradeHistory') || '[]');
            const list = document.getElementById('historyList');
            
            if (history.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #888;">Nenhuma opera√ß√£o registrada</p>';
                return;
            }
            
            list.innerHTML = history.map(trade => `
                <div class="history-item ${trade.result === 'WIN' ? 'history-win' : 'history-loss'}">
                    <div class="history-info">
                        <strong>${trade.asset}</strong>
                        <div style="font-size: 12px; color: #888;">
                            ${new Date(trade.timestamp).toLocaleString('pt-BR')}
                        </div>
                    </div>
                    <div class="history-result ${trade.result === 'WIN' ? 'result-win' : 'result-loss'}">
                        ${trade.result}
                    </div>
                </div>
            `).join('');
        }

        // Play Sound (using Web Audio API)
        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'alert':
                    oscillator.frequency.value = 800;
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.5);
                    break;
                case 'win':
                    oscillator.frequency.value = 1200;
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
                case 'loss':
                    oscillator.frequency.value = 300;
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.5);
                    break;
                default:
                    oscillator.frequency.value = 600;
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    oscillator.start();
                    oscillator.stop(audioContext.currentTime + 0.2);
            }
        }

        // Close alert on click
        document.getElementById('alertOverlay').onclick = function() {
            this.style.display = 'none';
        };
    </script>
</body>
</html>
